<div class="container mt-4">
  <h2 class="text-center text-primary mb-4 fw-bold">
    <i class="bi bi-pencil-square"></i> Edit Book Category
  </h2>

  <!-- Category Name -->
  <div class="card border-0 shadow-lg mb-4">
    <div class="card-header bg-primary text-white py-3">
      <h5 class="mb-0 fw-bold"><i class="bi bi-tag"></i> Category Information</h5>
    </div>
    <div class="card-body bg-light p-4">
      <div class="row">
        <div class="col-md-12">
          <label for="categoryName" class="form-label fw-bold">Category Name</label>
          <input [(ngModel)]="bookCategory.name"
                 type="text"
                 id="categoryName"
                 class="form-control form-control-lg"
                 placeholder="Enter category name">
        </div>
      </div>
    </div>
  </div>

  <!-- Add New Book Form -->
  <div class="card border-0 shadow-lg mb-4">
    <div class="card-header bg-warning text-dark py-3">
      <h5 class="mb-0 fw-bold"><i class="bi bi-book"></i> Add New Book</h5>
    </div>
    <div class="card-body bg-light p-4">
      <div class="row g-3">

        <!-- ðŸ†• NEW: Image Upload Field -->
        <div class="col-md-12 mb-3">
          <label for="bookImage" class="form-label fw-bold">
            <i class="bi bi-image"></i> Book Cover Image
          </label>
          <input type="file"
                 id="bookImage"
                 class="form-control"
                 accept="image/*"
                 (change)="onFileSelected($event)">

          <!-- Image Preview -->
          <div *ngIf="imagePreview" class="mt-3">
            <img [src]="imagePreview"
                 alt="Preview"
                 class="img-thumbnail shadow"
                 style="max-width: 200px; max-height: 250px; object-fit: cover;">
          </div>

          <!-- Upload Progress -->
          <div *ngIf="isUploading" class="mt-2">
            <div class="spinner-border spinner-border-sm text-primary" role="status">
              <span class="visually-hidden">Uploading...</span>
            </div>
            <span class="ms-2 text-primary">Uploading image...</span>
          </div>
        </div>

        <div class="col-md-4">
          <label for="title" class="form-label fw-bold">Book Title <span class="text-danger">*</span></label>
          <input [(ngModel)]="bookObj.title" type="text" id="title" class="form-control" placeholder="Enter book title">
        </div>
        <div class="col-md-4">
          <label for="isbn" class="form-label fw-bold">ISBN Number <span class="text-danger">*</span></label>
          <input [(ngModel)]="bookObj.isbn" type="text" id="isbn" class="form-control" placeholder="ISBN">
        </div>
        <div class="col-md-4">
          <label for="author" class="form-label fw-bold">Author <span class="text-danger">*</span></label>
          <input [(ngModel)]="bookObj.author" type="text" id="author" class="form-control" placeholder="Enter author name">
        </div>
        <div class="col-md-3">
          <label for="publisher" class="form-label fw-bold">Publisher</label>
          <input [(ngModel)]="bookObj.publisher" type="text" id="publisher" class="form-control" placeholder="Enter publisher name">
        </div>
        <div class="col-md-2">
          <label for="purchasePrice" class="form-label fw-bold">Purchase Price</label>
          <input [(ngModel)]="bookObj.purchasePrice" type="number" id="purchasePrice" class="form-control" placeholder="0.00">
        </div>
        <div class="col-md-2">
          <label for="sellingPrice" class="form-label fw-bold">Selling Price</label>
          <input [(ngModel)]="bookObj.sellingPrice" type="number" id="sellingPrice" class="form-control" placeholder="0.00">
        </div>
        <div class="col-md-2">
          <label for="pages" class="form-label fw-bold">Pages</label>
          <input [(ngModel)]="bookObj.pages" type="number" id="pages" class="form-control" placeholder="0">
        </div>
        <div class="col-md-2">
          <label for="stock" class="form-label fw-bold">Stock</label>
          <input [(ngModel)]="bookObj.stock" type="number" id="stock" class="form-control" placeholder="0">
        </div>
        <div class="col-md-1 d-flex align-items-end">
          <button (click)="addBook()"
                  class="btn btn-success w-100"
                  [disabled]="isUploading">
            <i class="bi bi-plus-lg"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Books List Table -->
  <div class="card border-0 shadow-lg mb-4" *ngIf="bookList.length > 0">
    <div class="card-header bg-info text-white py-3">
      <h5 class="mb-0 fw-bold"><i class="bi bi-list-ul"></i> Books in this Category ({{bookList.length}})</h5>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover table-striped mb-0">
          <thead class="table-dark">
            <tr>
              <th>Image</th> <!-- ðŸ†• NEW COLUMN -->
              <th>Title</th>
              <th>ISBN</th>
              <th>Author</th>
              <th>Publisher</th>
              <th>Purchase Price</th>
              <th>Selling Price</th>
              <th>Pages</th>
              <th>Stock</th>
              <th class="text-center">Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let book of bookList">
              <!-- ðŸ†• NEW: Image Column -->
              <td>
                <img [src]="getImageUrl(book.imageUrl)"
                     [alt]="book.title"
                     class="img-thumbnail"
                     style="width: 50px; height: 70px; object-fit: cover;"
                     (error)="$any($event.target).src='assets/images/no-image.jpg'">
              </td>
              <td class="fw-bold">{{book.title}}</td>
              <td>{{book.isbn}}</td>
              <td>{{book.author}}</td>
              <td>{{book.publisher}}</td>
              <td class="text-success fw-bold">à§³{{book.purchasePrice}}</td>
              <td class="text-primary fw-bold">à§³{{book.sellingPrice}}</td>
              <td>{{book.pages}}</td>
              <td><span class="badge bg-info">{{book.stock}}</span></td>
              <td class="text-center">
                <button (click)="deleteBook(book)" class="btn btn-danger btn-sm">
                  <i class="bi bi-trash"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- No Books Message -->
  <div class="alert alert-warning" *ngIf="bookList.length === 0">
    <i class="bi bi-exclamation-triangle"></i> No books in this category yet. Add books using the form above.
  </div>

  <!-- Action Buttons -->
  <div class="d-flex gap-3 mb-5">
    <button (click)="updateBookCategory()" class="btn btn-primary btn-lg px-5">
      <i class="bi bi-check-circle"></i> Update Category
    </button>
    <button (click)="cancel()" class="btn btn-secondary btn-lg px-5">
      <i class="bi bi-x-circle"></i> Cancel
    </button>
  </div>
</div>
